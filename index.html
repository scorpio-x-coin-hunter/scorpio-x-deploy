<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Blackbeard Empire Services</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background-color: #0b0c10;
      color: #f8f8f2;
      padding: 20px;
    }
    h1 {
      text-align: center;
      color: #f1c40f;
    }
    input[type="text"] {
      width: 100%;
      padding: 12px;
      margin: 20px 0;
      border: none;
      border-radius: 8px;
      font-size: 16px;
    }
    .service {
      background: #1f2833;
      padding: 15px;
      margin: 10px 0;
      border-left: 5px solid #f1c40f;
      border-radius: 5px;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    .service button {
      background: #45a29e;
      color: white;
      border: none;
      padding: 10px 16px;
      border-radius: 5px;
      cursor: pointer;
      font-weight: bold;
    }
    #paymentLink {
      margin-top: 20px;
      padding: 15px;
      background: #1c1c1c;
      border-radius: 8px;
      border: 1px solid #333;
      word-break: break-all;
    }
    form {
      background: #1c1c1c;
      padding: 20px;
      margin-top: 40px;
      border: 1px solid #333;
      border-radius: 8px;
    }
    form input, form textarea {
      width: 100%;
      padding: 10px;
      margin: 10px 0;
      border: none;
      border-radius: 5px;
    }
    form button {
      background: #45a29e;
      color: white;
      padding: 12px;
      border: none;
      border-radius: 6px;
      cursor: pointer;
      font-weight: bold;
    }
  </style>
</head>
<body>

  <h1>ü¶ú Blackbeard Empire Services</h1>
  <input type="text" id="search" placeholder="Search for a service...">

  <div id="services"></div>

  <div id="paymentLink"></div>

  <h2>üì¨ Custom Order Request</h2>
  <form action="https://formspree.io/f/mnqelpdo" method="POST">
    <input type="text" name="name" placeholder="Your name" required />
    <input type="email" name="email" placeholder="Your email" required />
    <textarea name="request" placeholder="What do you need?" rows="5" required></textarea>
    <button type="submit">Submit Request</button>
  </form>

  <script>
    const services = [
      "CV Creation",
      "Study Buddy",
      "Proofreading",
      "Website Design",
      "App Development",
      "Automation Consulting",
      "Free Launcher CV",
      "Chatbot Development",
      "Cover Letter",
      "Business Plan",
      "Logo Design",
      "Social Media Content",
      "Deck Design",
      "Online Course",
      "Technical Writing",
      "Translation",
      "SEO Optimization",
      "Content Writing",
      "Email Marketing",
      "Video Editing",
      "Voice Over",
      "Digital Marketing",
      "Data Analysis",
      "Project Management",
      "Graphic Design",
      "Social Media Management",
      "Copywriting",
      "Website Maintenance",
      "IT Support",
      "Resume Optimization",
      "Online Tutoring",
      "AI Chatbot Setup",
      "Business Naming",
      "Sales Funnel",
      "E-Commerce Setup",
      "Content Strategy",
      "Email Newsletter Setup",
      "Video Production",
      "Podcast Production",
      "Online Workshop",
      "SEO Audit",
      "Website SEO",
      "Lead Generation",
      "Online Reputation",
      "Newsletter Writing",
      "UX/UI Design",
      "Cybersecurity Assessment",
      "eBook Creation",
      "Presentation Design",
      "Technical Support"
    ];

    const serviceContainer = document.getElementById("services");
    const searchInput = document.getElementById("search");
    const paymentLinkDiv = document.getElementById("paymentLink");

    // Render services filtered by search
    function renderServices(filter = "") {
      paymentLinkDiv.innerHTML = ""; // Clear previous payment link
      serviceContainer.innerHTML = "";
      const filtered = services.filter(service =>
        service.toLowerCase().includes(filter.toLowerCase())
      );

      filtered.forEach(service => {
        const el = document.createElement("div");
        el.className = "service";

        const button = document.createElement("button");
        button.textContent = "üí≥ Pay Now";
        button.onclick = () => requestPaymentLink(service);

        el.innerHTML = `<strong>${service}</strong>`;
        el.appendChild(button);

        serviceContainer.appendChild(el);
      });
    }

    // Request payment link from backend API
    async function requestPaymentLink(serviceName) {
      paymentLinkDiv.textContent = "‚è≥ Generating payment link...";
      try {
        const response = await fetch("/command", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ message: `payment ${serviceName.toLowerCase()}` }),
        });

        const data = await response.json();

        if (data.reply && data.reply.includes("http")) {
          paymentLinkDiv.innerHTML = `<strong>Payment link for ${serviceName}:</strong><br/><a href="${extractUrl(data.reply)}" target="_blank">${extractUrl(data.reply)}</a>`;
        } else {
          paymentLinkDiv.textContent = "‚ùå Failed to get payment link. Please try again later.";
        }
      } catch (err) {
        paymentLinkDiv.textContent = "‚ùå Error contacting payment system.";
        console.error(err);
      }
    }

    // Helper to extract URL from the backend reply string
    function extractUrl(text) {
      const urlRegex = /(https?:\/\/[^\s]+)/g;
      const matches = text.match(urlRegex);
      return matches ? matches[0] : "";
    }

    searchInput.addEventListener("input", () => renderServices(searchInput.value));

    renderServices();
  </script>

</body>
</html>